!function(t){"use strict";const e={version:"1.0.0",instances:{},init:function(t){if(!t.target)throw new Error("VanityCert: target selector is required");if(!t.apiEndpoint)throw new Error("VanityCert: apiEndpoint is required");if(!t.serverId)throw new Error("VanityCert: serverId is required");if(!t.userId)throw new Error("VanityCert: userId is required");const e=document.querySelector(t.target);if(!e)throw new Error("VanityCert: target element not found");const n=new s(e,t);return this.instances[t.target]=n,n},getInstance:function(t){return this.instances[t]},destroy:function(t){const e=this.instances[t];e&&(e.destroy(),delete this.instances[t])}};class s{constructor(t,e){this.container=t,this.config={apiEndpoint:e.apiEndpoint,serverId:e.serverId,userId:e.userId,theme:e.theme||{},callbacks:e.callbacks||{},pollInterval:e.pollInterval||5e3,dnsPollInterval:e.dnsPollInterval||1e4},this.state={step:1,domain:null,domainId:null,domainUrl:"",dnsStatus:"pending",sslStatus:"pending",createdAt:null,error:null,isPolling:!1},this.pollTimer=null,this.init()}init(){this.loadState(),this.render(),this.applyTheme(),this.state.domainId&&this.state.step>1&&this.state.step<4&&this.startPolling()}loadState(){try{const t=localStorage.getItem(`vanitycert_${this.config.userId}`);if(t){const e=JSON.parse(t);e.domainId&&e.step<4&&(this.state={...this.state,...e})}}catch(t){console.error("VanityCert: Failed to load state",t)}}saveState(){try{localStorage.setItem(`vanitycert_${this.config.userId}`,JSON.stringify(this.state))}catch(t){console.error("VanityCert: Failed to save state",t)}}clearState(){try{localStorage.removeItem(`vanitycert_${this.config.userId}`)}catch(t){console.error("VanityCert: Failed to clear state",t)}}applyTheme(){if(!this.config.theme)return;const t=this.container,e=this.config.theme;e.primaryColor&&t.style.setProperty("--vc-primary-color",e.primaryColor),e.secondaryColor&&t.style.setProperty("--vc-secondary-color",e.secondaryColor),e.successColor&&t.style.setProperty("--vc-success-color",e.successColor),e.errorColor&&t.style.setProperty("--vc-error-color",e.errorColor),e.borderRadius&&t.style.setProperty("--vc-border-radius",e.borderRadius),e.fontFamily&&t.style.setProperty("--vc-font-family",e.fontFamily)}render(){this.container.innerHTML=`\n        <div class="vanitycert-widget">\n          ${this.renderStepper()}\n          ${this.renderStepContent()}\n        </div>\n      `,this.attachEventListeners()}renderStepper(){return`\n        <div class="vc-stepper">\n          ${[{number:1,label:"Enter Domain"},{number:2,label:"Validate DNS"},{number:3,label:"Issue Certificate"},{number:4,label:"Ready to Use"}].map(t=>`\n            <div class="vc-step ${t.number===this.state.step?"active":""} ${t.number<this.state.step?"completed":""}">\n              <div class="vc-step-number">\n                ${t.number<this.state.step?'<svg class="vc-check-icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>':t.number}\n              </div>\n              <div class="vc-step-label">${t.label}</div>\n            </div>\n          `).join("")}\n        </div>\n      `}renderStepContent(){switch(this.state.step){case 1:return this.renderStep1();case 2:return this.renderStep2();case 3:return this.renderStep3();case 4:return this.renderStep4();default:return""}}renderStep1(){return`\n        <div class="vc-step-content">\n          <h2 class="vc-title">Enter Your Domain</h2>\n          <p class="vc-description">Enter the domain name you want to secure with an SSL certificate.</p>\n\n          ${this.state.error?`\n            <div class="vc-alert vc-alert-error">\n              <svg class="vc-alert-icon" viewBox="0 0 24 24">\n                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>\n              </svg>\n              <span>${this.state.error}</span>\n            </div>\n          `:""}\n\n          <form class="vc-form" id="vc-domain-form">\n            <div class="vc-form-group">\n              <label for="vc-domain-input" class="vc-label">Domain Name</label>\n              <input\n                type="text"\n                id="vc-domain-input"\n                class="vc-input"\n                placeholder="app.yourdomain.com"\n                value="${this.state.domainUrl||""}"\n                required\n              />\n              <p class="vc-help-text">Enter a subdomain (e.g., app.example.com). Apex domains are not supported.</p>\n            </div>\n\n            <button type="submit" class="vc-button vc-button-primary">\n              Continue\n            </button>\n          </form>\n        </div>\n      `}renderStep2(){const t=this.check24HourTimeout(),e="error"===this.state.dnsStatus||t;return`\n        <div class="vc-step-content">\n          <h2 class="vc-title">Configure DNS</h2>\n          <p class="vc-description">Add the following CNAME record to your DNS provider.</p>\n\n          ${e?'\n            <div class="vc-alert vc-alert-error">\n              <svg class="vc-alert-icon" viewBox="0 0 24 24">\n                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>\n              </svg>\n              <div>\n                <strong>DNS Validation Failed</strong>\n                <p class="vc-error-detail">We couldn\'t find the CNAME record after 24 hours. Please verify your DNS configuration and try again.</p>\n              </div>\n            </div>\n          ':""}\n\n          <div class="vc-dns-box">\n            <div class="vc-dns-row">\n              <div class="vc-dns-label">Type:</div>\n              <div class="vc-dns-value">\n                <code>CNAME</code>\n                <button class="vc-copy-btn" data-copy="CNAME" title="Copy">\n                  <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>\n                </button>\n              </div>\n            </div>\n            <div class="vc-dns-row">\n              <div class="vc-dns-label">Name:</div>\n              <div class="vc-dns-value">\n                <code>${this.state.domainUrl}</code>\n                <button class="vc-copy-btn" data-copy="${this.state.domainUrl}" title="Copy">\n                  <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>\n                </button>\n              </div>\n            </div>\n            <div class="vc-dns-row">\n              <div class="vc-dns-label">Target:</div>\n              <div class="vc-dns-value">\n                <code>my.vanitycert.com</code>\n                <button class="vc-copy-btn" data-copy="my.vanitycert.com" title="Copy">\n                  <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <div class="vc-info-box">\n            <svg class="vc-info-icon" viewBox="0 0 24 24">\n              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>\n            </svg>\n            <div>\n              <strong>DNS Propagation</strong>\n              <p>DNS changes can take 5-30 minutes to propagate. We'll automatically check for the record.</p>\n            </div>\n          </div>\n\n          ${e?'\n            <div class="vc-retry-section">\n              <button class="vc-button vc-button-primary" id="vc-retry-btn">\n                <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; margin-right: 8px;">\n                  <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>\n                </svg>\n                Retry Validation\n              </button>\n              <button class="vc-button vc-button-secondary" id="vc-cancel-btn">Start Over</button>\n            </div>\n          ':'\n            <div class="vc-status-indicator">\n              <div class="vc-spinner"></div>\n              <span>Checking DNS records...</span>\n            </div>\n          '}\n        </div>\n      `}renderStep3(){return`\n        <div class="vc-step-content">\n          <h2 class="vc-title">Issuing SSL Certificate</h2>\n          <p class="vc-description">Your SSL certificate is being provisioned. This usually takes 1-5 minutes.</p>\n\n          <div class="vc-progress-box">\n            <div class="vc-progress-steps">\n              <div class="vc-progress-step ${"validated"===this.state.dnsStatus?"completed":""}">\n                <div class="vc-progress-icon">\n                  ${"validated"===this.state.dnsStatus?'<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>':'<div class="vc-spinner-small"></div>'}\n                </div>\n                <span>DNS Validated</span>\n              </div>\n\n              <div class="vc-progress-step ${"active"===this.state.sslStatus?"completed":""}">\n                <div class="vc-progress-icon">\n                  ${"active"===this.state.sslStatus?'<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>':'<div class="vc-spinner-small"></div>'}\n                </div>\n                <span>Certificate Issued</span>\n              </div>\n\n              <div class="vc-progress-step ${"active"===this.state.sslStatus?"completed":""}">\n                <div class="vc-progress-icon">\n                  ${"active"===this.state.sslStatus?'<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>':'<div class="vc-spinner-small"></div>'}\n                </div>\n                <span>Ready to Use</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="vc-info-box">\n            <svg class="vc-info-icon" viewBox="0 0 24 24">\n              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>\n            </svg>\n            <div>\n              <strong>Automatic Process</strong>\n              <p>You can safely leave this page. We'll continue provisioning your certificate in the background.</p>\n            </div>\n          </div>\n        </div>\n      `}renderStep4(){return`\n        <div class="vc-step-content">\n          <div class="vc-success-box">\n            <svg class="vc-success-icon" viewBox="0 0 24 24">\n              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n            </svg>\n            <h2 class="vc-title">SSL Certificate Active!</h2>\n            <p class="vc-description">Your domain <strong>${this.state.domainUrl}</strong> is now secured with an SSL certificate.</p>\n          </div>\n\n          <div class="vc-certificate-details">\n            <div class="vc-detail-row">\n              <span class="vc-detail-label">Domain:</span>\n              <span class="vc-detail-value">${this.state.domainUrl}</span>\n            </div>\n            <div class="vc-detail-row">\n              <span class="vc-detail-label">Status:</span>\n              <span class="vc-detail-value vc-status-badge vc-status-active">Active</span>\n            </div>\n            <div class="vc-detail-row">\n              <span class="vc-detail-label">Valid For:</span>\n              <span class="vc-detail-value">90 days</span>\n            </div>\n          </div>\n\n          <div class="vc-info-box">\n            <svg class="vc-info-icon" viewBox="0 0 24 24">\n              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>\n            </svg>\n            <div>\n              <strong>Automatic Renewal</strong>\n              <p>Your certificate will automatically renew before it expires. You don't need to do anything.</p>\n            </div>\n          </div>\n\n          <button class="vc-button vc-button-secondary" id="vc-done-btn">Done</button>\n        </div>\n      `}attachEventListeners(){const t=this.container.querySelector("#vc-domain-form");t&&t.addEventListener("submit",t=>{t.preventDefault(),this.handleDomainSubmit()});this.container.querySelectorAll(".vc-copy-btn").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),this.handleCopy(t.dataset.copy,t)})});const e=this.container.querySelector("#vc-retry-btn");e&&e.addEventListener("click",()=>this.handleRetry());const s=this.container.querySelector("#vc-cancel-btn");s&&s.addEventListener("click",()=>this.handleCancel());const n=this.container.querySelector("#vc-done-btn");n&&n.addEventListener("click",()=>this.handleDone())}async handleDomainSubmit(){const t=this.container.querySelector("#vc-domain-input").value.trim();if(!this.validateDomain(t))return this.state.error="Please enter a valid subdomain (e.g., app.example.com)",void this.render();this.state.error=null;try{const e=this.container.querySelector('button[type="submit"]');e.disabled=!0,e.innerHTML='<div class="vc-spinner-small"></div> Creating...';const s=await this.apiRequest("POST","/domains",{url:t,server_id:this.config.serverId});this.state.domainUrl=t,this.state.domainId=s.id,this.state.domain=s,this.state.dnsStatus=s.dns_status||"pending",this.state.sslStatus=s.ssl_status||"pending",this.state.createdAt=s.created_at||(new Date).toISOString(),this.state.step=2,this.saveState(),this.triggerCallback("onDomainCreated",s),this.render(),this.startPolling()}catch(t){this.state.error=t.message||"Failed to create domain. Please try again.",this.render(),this.triggerCallback("onError",t)}}validateDomain(t){if(t.split(".").length<2)return!1;if(t.match(/^https?:\/\//i))return!1;return/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?(\.[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)+$/i.test(t)}startPolling(){this.state.isPolling||(this.state.isPolling=!0,this.poll())}stopPolling(){this.state.isPolling=!1,this.pollTimer&&(clearTimeout(this.pollTimer),this.pollTimer=null)}async poll(){if(this.state.isPolling&&this.state.domainId)try{const t=await this.apiRequest("GET",`/domains/${this.state.domainId}`),e=this.state.dnsStatus,s=this.state.sslStatus;if(this.state.dnsStatus=t.dns_status,this.state.sslStatus=t.ssl_status,this.state.domain=t,"validated"!==e&&"validated"===this.state.dnsStatus&&(this.triggerCallback("onDnsValidated",t),this.state.step=3,this.render()),"active"!==s&&"active"===this.state.sslStatus)return this.stopPolling(),this.triggerCallback("onCertificateIssued",t),this.state.step=4,this.saveState(),void this.render();if("error"===this.state.dnsStatus||"error"===this.state.sslStatus)return this.stopPolling(),this.triggerCallback("onValidationFailed",t,"DNS or SSL validation failed"),void this.render();if(this.check24HourTimeout())return this.stopPolling(),this.triggerCallback("onValidationFailed",t,"DNS validation timeout (24 hours)"),void this.render();this.saveState();const n=2===this.state.step?this.config.dnsPollInterval:this.config.pollInterval;this.pollTimer=setTimeout(()=>this.poll(),n)}catch(t){console.error("VanityCert: Polling error",t),this.pollTimer=setTimeout(()=>this.poll(),this.config.pollInterval)}}check24HourTimeout(){if(!this.state.createdAt)return!1;const t=new Date(this.state.createdAt);return(new Date-t)/36e5>=24}async handleCopy(t,e){try{await navigator.clipboard.writeText(t);const s=e.innerHTML;e.innerHTML='<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>',e.classList.add("vc-copied"),setTimeout(()=>{e.innerHTML=s,e.classList.remove("vc-copied")},2e3)}catch(t){console.error("VanityCert: Copy failed",t)}}async handleRetry(){try{await this.apiRequest("DELETE",`/domains/${this.state.domainId}`)}catch(t){console.warn("VanityCert: Failed to delete old domain",t)}const t=this.state.domainUrl;this.state={step:1,domain:null,domainId:null,domainUrl:t,dnsStatus:"pending",sslStatus:"pending",createdAt:null,error:null,isPolling:!1},this.saveState(),this.render()}async handleCancel(){try{this.state.domainId&&await this.apiRequest("DELETE",`/domains/${this.state.domainId}`)}catch(t){console.warn("VanityCert: Failed to delete domain",t)}this.stopPolling(),this.state={step:1,domain:null,domainId:null,domainUrl:"",dnsStatus:"pending",sslStatus:"pending",createdAt:null,error:null,isPolling:!1},this.clearState(),this.render()}handleDone(){this.clearState(),this.triggerCallback("onComplete",this.state.domain)}async apiRequest(t,e,s=null){const n=`${this.config.apiEndpoint}${e}`,i={method:t,headers:{"Content-Type":"application/json"}};s&&(i.body=JSON.stringify(s));const a=await fetch(n,i);if(!a.ok){const t=await a.json().catch(()=>({error:{message:a.statusText}}));throw new Error(t.error?.message||t.message||"Request failed")}return a.json()}triggerCallback(t,...e){if(this.config.callbacks[t])try{this.config.callbacks[t](...e)}catch(e){console.error(`VanityCert: Callback ${t} failed`,e)}}destroy(){this.stopPolling(),this.container.innerHTML=""}}t.VanityCert=e}(window);